
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Widget</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .chat-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: white;
        }
        .chat-header {
            background: #2563eb;
            color: white;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }
        .tab-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }
        .tab-content.hidden {
            display: none !important;
        }
        .tab-navigation {
            border-top: 1px solid #e5e7eb;
            background: white;
            flex-shrink: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: 56px;
            padding: 4px;
        }
        .tab-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            height: 100%;
            border: 2px solid transparent;
            border-radius: 8px;
            background: none;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
        }
        .tab-button.active {
            border-color: #2563eb;
            background: rgba(37, 99, 235, 0.05);
            color: #2563eb;
        }
        .tab-badge {
            background: #2563eb;
            color: white;
            font-size: 12px;
            border-radius: 50%;
            padding: 2px 6px;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* Home tab styles */
        .home-content {
            flex: 1;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow-y: auto;
        }
        .welcome-section {
            max-width: 400px;
            margin-bottom: 2rem;
        }
        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            width: 100%;
            max-width: 600px;
        }
        .topic-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        .topic-card:hover {
            border-color: #2563eb;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
        }
        .topic-icon {
            width: 48px;
            height: 48px;
            background: rgba(37, 99, 235, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 24px;
        }
        /* Chat tab styles */
        .chat-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            min-height: 0;
        }
        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #6b7280;
        }
        .message-group {
            margin: 1rem 0;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }
        .message-group.user {
            justify-content: flex-end;
        }
        .message-group .avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .message-group .messages {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            max-width: 80%;
        }
        .message-group.user .messages {
            align-items: flex-end;
        }
        .bubble {
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            animation: fadeIn 0.3s ease-in;
        }
        .bubble.user {
            background: #2563eb;
            color: white;
        }
        .bubble.bot {
            background: #f3f4f6;
            color: #1f2937;
        }
        .bubble.card, .bubble.menu {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 0;
            overflow: hidden;
        }
        .input-container {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0;
        }
        .input-container input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            outline: none;
        }
        .input-container button {
            padding: 0.75rem 1.5rem;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        .input-container button:hover {
            background: #1d4ed8;
        }
        .input-container button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        .quick-reply {
            padding: 0.25rem 0.75rem;
            background: #f3f4f6;
            border: none;
            border-radius: 1rem;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .quick-reply:hover {
            background: #e5e7eb;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.75rem 1rem;
            background: #f3f4f6;
            border-radius: 0.75rem;
            margin: 0.25rem 0;
            animation: fadeIn 0.3s ease-in;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #6b7280;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        .card-content {
            padding: 12px;
        }
        .card-title {
            font-weight: 600;
            margin-bottom: 8px;
        }
        .card-description {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 12px;
        }
        .card-image {
            width: 100%;
            height: 128px;
            object-fit: cover;
        }
        .menu-content {
            padding: 12px;
        }
        .menu-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: left;
            width: 100%;
            margin-bottom: 8px;
            transition: background-color 0.2s;
        }
        .menu-option:hover {
            background: #f9fafb;
        }
        .menu-option:last-child {
            margin-bottom: 0;
        }
        .timestamp {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div id="chat-root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Home Tab Component
        function HomeTab({ onStartChat, isMobile }) {
            const topics = [
                {
                    id: 'billing',
                    title: 'Billing & Payments',
                    description: 'Questions about invoices, payments, and billing',
                    icon: 'ðŸ’³',
                    message: 'I have a question about billing and payments'
                },
                {
                    id: 'technical',
                    title: 'Technical Support',
                    description: 'Help with technical issues and troubleshooting',
                    icon: 'ðŸ”§',
                    message: 'I need technical support'
                },
                {
                    id: 'sales',
                    title: 'Sales Questions',
                    description: 'Product information and sales inquiries',
                    icon: 'ðŸ’¼',
                    message: 'I have sales questions'
                },
                {
                    id: 'general',
                    title: 'General Support',
                    description: 'General questions and other topics',
                    icon: 'ðŸ’¬',
                    message: 'I need general support'
                }
            ];

            return (
                <div className="home-content">
                    <div className="welcome-section">
                        <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '16px', color: '#1f2937' }}>
                            Welcome to Support
                        </h2>
                        <p style={{ color: '#6b7280', marginBottom: '32px' }}>
                            How can we help you today? Choose a topic below to get started.
                        </p>
                    </div>
                    
                    <div className="topic-grid">
                        {topics.map(topic => (
                            <div 
                                key={topic.id}
                                className="topic-card"
                                onClick={() => onStartChat(topic.id, topic.message)}
                            >
                                <div className="topic-icon">
                                    {topic.icon}
                                </div>
                                <h3 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '8px', color: '#1f2937' }}>
                                    {topic.title}
                                </h3>
                                <p style={{ fontSize: '14px', color: '#6b7280', margin: 0 }}>
                                    {topic.description}
                                </p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Message Bubble Component
        function MessageBubble({ message, onOptionSelect, onQuickReply }) {
            const renderRichMessage = (message) => {
                if (message.messageType === 'card' && message.metadata) {
                    return React.createElement('div', { 
                        className: 'bubble card'
                    }, [
                        message.metadata.imageUrl && React.createElement('img', {
                            key: 'image',
                            src: message.metadata.imageUrl,
                            alt: message.metadata.title || 'Card image',
                            className: 'card-image'
                        }),
                        React.createElement('div', { key: 'content', className: 'card-content' }, [
                            message.metadata.title && React.createElement('h4', {
                                key: 'title',
                                className: 'card-title'
                            }, message.metadata.title),
                            message.metadata.description && React.createElement('p', {
                                key: 'desc',
                                className: 'card-description'
                            }, message.metadata.description),
                            message.content && message.content !== message.metadata.title && React.createElement('p', {
                                key: 'content'
                            }, message.content),
                            message.metadata.buttons && React.createElement('div', {
                                key: 'buttons',
                                style: { display: 'flex', flexDirection: 'column', gap: '8px' }
                            }, message.metadata.buttons.map((button, idx) => 
                                React.createElement('button', {
                                    key: idx,
                                    onClick: () => onOptionSelect(button.id, button.payload, button.text),
                                    className: 'menu-option'
                                }, button.text)
                            ))
                        ])
                    ]);
                }

                if (message.messageType === 'menu' && message.metadata?.options) {
                    return React.createElement('div', {
                        className: 'bubble menu'
                    }, [
                        React.createElement('div', { key: 'content', className: 'menu-content' }, [
                            message.content && React.createElement('p', { key: 'text', style: { marginBottom: '12px' } }, message.content),
                            React.createElement('div', { 
                                key: 'options'
                            }, message.metadata.options.map((option, idx) =>
                                React.createElement('button', {
                                    key: idx,
                                    onClick: () => onOptionSelect(option.id, option.payload, option.text),
                                    className: 'menu-option'
                                }, option.text)
                            ))
                        ])
                    ]);
                }

                if (message.messageType === 'image' && message.metadata?.imageUrl) {
                    return React.createElement('div', {
                        className: 'bubble card'
                    }, [
                        React.createElement('img', {
                            key: 'image',
                            src: message.metadata.imageUrl,
                            alt: message.metadata.title || 'Message image',
                            className: 'card-image'
                        }),
                        message.content && React.createElement('div', {
                            key: 'content',
                            className: 'card-content'
                        }, React.createElement('p', {}, message.content))
                    ]);
                }

                // Default text message
                return React.createElement('div', {
                    className: `bubble ${message.sender}`
                }, [
                    React.createElement('p', { key: 'content' }, message.content),
                    message.metadata?.quickReplies && React.createElement('div', {
                        key: 'quickReplies',
                        className: 'quick-replies'
                    }, message.metadata.quickReplies.map((reply, idx) =>
                        React.createElement('button', {
                            key: idx,
                            onClick: () => onQuickReply(reply),
                            className: 'quick-reply'
                        }, reply)
                    ))
                ]);
            };

            return renderRichMessage(message);
        }

        // Main Chat Widget Component
        function ChatWidget() {
            const [messages, setMessages] = useState([]);
            const [inputValue, setInputValue] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [isStreaming, setIsStreaming] = useState(false);
            const [activeTab, setActiveTab] = useState('home');
            const messagesEndRef = useRef(null);

            const sessionId = "{{SESSION_ID}}";
            let apiUrl = "{{API_URL}}";
            const isMobile = {{IS_MOBILE}};

            // Fix mixed content issues
            if (window.location.protocol === 'https:' && apiUrl.startsWith('http:')) {
                apiUrl = apiUrl.replace('http:', 'https:');
            }

            useEffect(() => {
                loadMessages();
            }, []);

            useEffect(() => {
                scrollToBottom();
            }, [messages, isTyping]);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            const loadMessages = async () => {
                try {
                    const response = await fetch(`${apiUrl}/api/chat/${sessionId}`);
                    const data = await response.json();
                    setMessages(data);
                } catch (error) {
                    console.error('Error loading messages:', error);
                }
            };

            const addMessage = (message) => {
                setMessages(prev => [...prev, message]);
            };

            const sendStreamingMessage = async (message) => {
                const userMessage = { 
                    sender: 'user', 
                    content: message,
                    messageType: 'text',
                    createdAt: new Date().toISOString(),
                    metadata: {}
                };
                addMessage(userMessage);
                setInputValue('');
                setIsStreaming(true);
                setIsTyping(true);

                try {
                    const response = await fetch(`${apiUrl}/api/chat/${sessionId}/messages/stream`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ content: message }),
                    });

                    if (!response.body) {
                        throw new Error('No response body');
                    }

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let buffer = '';

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;

                        buffer += decoder.decode(value, { stream: true });
                        const lines = buffer.split('\n');
                        buffer = lines.pop() || '';

                        for (const line of lines) {
                            if (line.startsWith('data: ')) {
                                try {
                                    const data = JSON.parse(line.slice(6));

                                    if (data.type === 'bubble' && data.message) {
                                        setIsTyping(false);
                                        addMessage(data.message);
                                        
                                        setTimeout(() => {
                                            setIsTyping(true);
                                        }, 100);
                                    } else if (data.type === 'complete') {
                                        setIsTyping(false);
                                        setIsStreaming(false);
                                    } else if (data.type === 'error') {
                                        setIsTyping(false);
                                        setIsStreaming(false);
                                        addMessage({
                                            sender: 'bot',
                                            content: data.message,
                                            messageType: 'text',
                                            createdAt: new Date().toISOString(),
                                            metadata: {}
                                        });
                                    } else if (data.type === 'end') {
                                        setIsTyping(false);
                                        setIsStreaming(false);
                                        break;
                                    }
                                } catch (parseError) {
                                    console.warn('Failed to parse streaming data:', parseError);
                                }
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error in streaming:', error);
                    setIsTyping(false);
                    setIsStreaming(false);
                    addMessage({
                        sender: 'bot',
                        content: 'Sorry, I encountered an error. Please try again.',
                        messageType: 'text',
                        createdAt: new Date().toISOString(),
                        metadata: {}
                    });
                }
            };

            const sendMessage = async (e) => {
                e.preventDefault();
                if (!inputValue.trim() || isStreaming) return;

                const message = inputValue.trim();
                setActiveTab('chat');
                await sendStreamingMessage(message);
            };

            const handleOptionSelect = async (optionId, payload, optionText) => {
                if (isStreaming) return;

                const displayText = optionText || getOptionDisplayText(optionId);
                addMessage({
                    content: displayText,
                    sender: 'user',
                    messageType: 'text',
                    createdAt: new Date().toISOString(),
                    metadata: {}
                });

                setIsTyping(true);

                try {
                    const response = await fetch(`${apiUrl}/api/chat/${sessionId}/select-option`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ optionId, payload, optionText })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.allMessages && data.allMessages.length > 0) {
                            data.allMessages.forEach(message => addMessage(message));
                        } else if (data.botMessage) {
                            addMessage(data.botMessage);
                        }
                    }
                } catch (error) {
                    console.error('Error selecting option:', error);
                    addMessage({
                        content: 'Sorry, there was an error processing your selection.',
                        sender: 'bot',
                        messageType: 'text',
                        createdAt: new Date().toISOString(),
                        metadata: {}
                    });
                } finally {
                    setIsTyping(false);
                }
            };

            const getOptionDisplayText = (optionId) => {
                const optionTexts = {
                    billing: "I have a question about my billing",
                    technical: "I need technical support", 
                    sales: "I have a sales inquiry",
                    payment: "I have payment issues",
                    subscription: "I want to change my subscription",
                    invoice: "I need to download an invoice",
                    general: "I need general support"
                };
                return optionTexts[optionId] || optionId.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()).trim();
            };

            const handleQuickReply = async (reply) => {
                if (isStreaming) return;
                setActiveTab('chat');
                await sendStreamingMessage(reply);
            };

            const handleStartChat = async (topic, message) => {
                setActiveTab('chat');
                if (message) {
                    setTimeout(() => {
                        sendStreamingMessage(message);
                    }, 100);
                }
            };

            const closeChat = () => {
                if (window.parent !== window) {
                    window.parent.postMessage({ type: 'CLOSE_CHAT' }, '*');
                }
            };

            const formatTimeAgo = (dateString) => {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                
                if (diffMins < 1) return 'just now';
                if (diffMins < 60) return `${diffMins}m ago`;
                const diffHours = Math.floor(diffMins / 60);
                if (diffHours < 24) return `${diffHours}h ago`;
                const diffDays = Math.floor(diffHours / 24);
                return `${diffDays}d ago`;
            };

            const groupMessages = (messages) => {
                const groups = [];
                let currentGroup = null;

                messages.forEach(message => {
                    const isFollowUp = message.metadata?.isFollowUp;
                    
                    if (!currentGroup || message.sender !== currentGroup.sender || !isFollowUp) {
                        currentGroup = {
                            sender: message.sender,
                            messages: [message],
                            timestamp: message.createdAt
                        };
                        groups.push(currentGroup);
                    } else {
                        currentGroup.messages.push(message);
                    }
                });

                return groups;
            };

            const messageGroups = groupMessages(messages);

            return (
                <div className="chat-container">
                    <div className="chat-header">
                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                            <img 
                                src="https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&auto=format&fit=crop&w=256&h=256"
                                alt="Support"
                                style={{ width: '28px', height: '28px', borderRadius: '50%' }}
                            />
                            <div>
                                <h3 style={{ margin: 0, fontWeight: '600' }}>Support Assistant</h3>
                                <div style={{ fontSize: '0.75rem', opacity: 0.8 }}>
                                    <span style={{ display: 'inline-block', width: '8px', height: '8px', backgroundColor: '#10b981', borderRadius: '50%', marginRight: '4px' }}></span>
                                    Online
                                </div>
                            </div>
                        </div>
                        <button onClick={closeChat} style={{ background: 'none', border: 'none', color: 'white', cursor: 'pointer', padding: '0.5rem' }}>
                            {isMobile ? (
                                React.createElement('svg', { width: '20', height: '20', fill: 'currentColor', viewBox: '0 0 24 24' }, 
                                    React.createElement('path', { d: 'M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z' })
                                )
                            ) : (
                                React.createElement('svg', { width: '16', height: '16', fill: 'currentColor', viewBox: '0 0 24 24' }, 
                                    React.createElement('path', { d: 'M19 13H5v-2h14v2z' })
                                )
                            )}
                        </button>
                    </div>

                    {/* Home Tab Content */}
                    <div className={`tab-content ${activeTab !== 'home' ? 'hidden' : ''}`}>
                        <HomeTab onStartChat={handleStartChat} isMobile={isMobile} />
                    </div>

                    {/* Chat Tab Content */}
                    <div className={`tab-content ${activeTab !== 'chat' ? 'hidden' : ''}`}>
                        <div className="chat-content">
                            {messageGroups.length === 0 ? (
                                <div className="empty-state">
                                    <div style={{ fontSize: '48px', marginBottom: '1rem' }}>ðŸ’¬</div>
                                    <h3 style={{ fontWeight: '500', marginBottom: '0.5rem' }}>No messages yet</h3>
                                    <p style={{ fontSize: '14px' }}>Start a conversation or go to Home to choose a topic</p>
                                </div>
                            ) : (
                                messageGroups.map((group, groupIndex) => (
                                    React.createElement('div', {
                                        key: groupIndex,
                                        className: `message-group ${group.sender}`
                                    }, [
                                        group.sender === 'bot' && React.createElement('img', {
                                            key: 'avatar',
                                            src: "https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&auto=format&fit=crop&w=256&h=256",
                                            alt: "Bot avatar",
                                            className: "avatar"
                                        }),
                                        React.createElement('div', {
                                            key: 'messages',
                                            className: 'messages'
                                        }, [
                                            ...group.messages.map((message, messageIndex) => (
                                                React.createElement(MessageBubble, {
                                                    key: `${groupIndex}-${messageIndex}`,
                                                    message: message,
                                                    onOptionSelect: handleOptionSelect,
                                                    onQuickReply: handleQuickReply
                                                })
                                            )),
                                            React.createElement('div', {
                                                key: 'timestamp',
                                                className: 'timestamp'
                                            }, formatTimeAgo(group.timestamp))
                                        ])
                                    ])
                                ))
                            )}

                            {isTyping && (
                                <div className="message-group bot">
                                    <img 
                                        src="https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&auto=format&fit=crop&w=256&h=256"
                                        alt="Bot avatar"
                                        className="avatar"
                                    />
                                    <div className="messages">
                                        <div className="typing-indicator">
                                            <div className="typing-dot"></div>
                                            <div className="typing-dot"></div>
                                            <div className="typing-dot"></div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div ref={messagesEndRef} />
                        </div>

                        <form onSubmit={sendMessage} className="input-container">
                            <input
                                type="text"
                                value={inputValue}
                                onChange={(e) => setInputValue(e.target.value)}
                                placeholder="Type your message..."
                                disabled={isStreaming}
                            />
                            <button type="submit" disabled={isStreaming}>
                                Send
                            </button>
                        </form>

                        <div className="quick-replies">
                            <button 
                                className="quick-reply"
                                onClick={() => handleQuickReply("Thank you")}
                                disabled={isStreaming}
                            >
                                Thank you
                            </button>
                            <button 
                                className="quick-reply"
                                onClick={() => handleQuickReply("I need more help")}
                                disabled={isStreaming}
                            >
                                I need more help
                            </button>
                            <button 
                                className="quick-reply"
                                onClick={() => handleQuickReply("Contact human agent")}
                                disabled={isStreaming}
                            >
                                Contact agent
                            </button>
                        </div>
                    </div>

                    {/* Tab Navigation */}
                    <div className="tab-navigation">
                        <button 
                            className={`tab-button ${activeTab === 'home' ? 'active' : ''}`}
                            onClick={() => setActiveTab('home')}
                        >
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                            </svg>
                            {!isMobile && <span>Home</span>}
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'chat' ? 'active' : ''}`}
                            onClick={() => setActiveTab('chat')}
                        >
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                            </svg>
                            {!isMobile && <span>Chat</span>}
                            {messages.length > 0 && (
                                <span className="tab-badge">
                                    {messages.length}
                                </span>
                            )}
                        </button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('chat-root'));
        root.render(React.createElement(ChatWidget));
    </script>
</body>
</html>
